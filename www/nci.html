<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title> Tapestry </title>
  	    <link rel="stylesheet" href="static/libs/foundation/normalize.css" />
  	    <link rel="stylesheet" href="static/libs/foundation/foundation.min.css"> 
        <link rel="stylesheet" href="static/foundation.overrides.css"> 
		<link rel="stylesheet" href="static/libs/font-awesome/css/font-awesome.min.css" >
		
		<script src='static/libs/google/google.jsapi.js'></script>
		<script src='static/libs/google/google.corechart.min.js'></script>
		<script src='static/libs/jquery/jquery-1.9.1.js'></script>	
	
	</head>
	<body>
		<nav class="top-bar">
			Tapestry for Infoblox Network		
		</nav> 
		
		<div class="row info-row">
			<div class="large-10 small-10 columns">
			<div class="large-6 small-12 columns nci-label">
				<div id="nciLatestValue" class="indexValue"></div><br>
			</div>	
			<div class="large-6 small-12 columns ">  
				<div id="nepLatestValue" class="indexValue"></div>	<br>
				<div id="qpsLatestValue" class="indexValue"></div>
			</div>	
			</div>	
			<div class="large-2 small-2 columns">
				<i class="icon-cog"></i>
				<i class="icon-info"></i>
			</div>	  
		</div>  
		  
		<div class="row">
	  		  <div class="large-12 columns">&nbsp;
	  			  <div id="visualization" class="nci-chart"></div>
	  		  </div>
		</div>
		
		<div class="row">
			<div class="large-12 small-12 columns">
				<h3 id="periodLabel" class="timePeriod"> <small> data for last </small> 1 min</h3>
			</div>
			<div class="large-8  small-12 columns">
				<br>
				<input id="slider" type="range"
				   class="date-slider" value="0" min="0" max="133" data-highlight="true" />
			</div>
		</div>
		
		<script src='static/nci.js'></script>
		<script src='static/libs/foundation/foundation.min.js'></script>  
		<script src='static/chart.js'></script>
		<script type="text/javascript">
		    $('#visualization').height(NCI.getChartHeight());
		    google.setOnLoadCallback(NCI.initChart);
			$(function(){
		    	$(document).foundation();
			});
            var connection = new WebSocket("ws://" + 'nci.ilabs.inca.infoblox.com:28080' + "/clientsock.yaws");
		        connection.onopen = function () {
			    connection.send('START_DATA');
		    };
		 
		    connection.onmessage  = function (e) {
				var data = eval("tmp = " + e.data );
				var params = {};
				params.time = new Date(data.Time).getMinutes() + ":" + new Date(data.Time).getSeconds();
				if (data.NCI){
					NCI.setNciLatestValue(NCI.parceNumberForView(data.NCI), NCI.parceDataForLastUpdate(data.Time));
					params.NCI = data.NCI;
					NCI.addValueToChart(params);
				};
				if (data.QPS)
					NCI.setQpsLatestValue(NCI.parceNumberForView(data.QPS), NCI.parceDataForLastUpdate(data.Time));
				if (data.NEP)
					NCI.setNepLatestValue(NCI.parceNumberForView(data.NEP), NCI.parceDataForLastUpdate(data.Time));
		    };
		</script> 
	</body>
</html>