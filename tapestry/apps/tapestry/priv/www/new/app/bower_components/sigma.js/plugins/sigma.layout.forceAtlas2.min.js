(function(undefined){"use strict";function Supervisor(sigInst,options){var _this=this,workerFn=sigInst.getForceAtlas2Worker&&sigInst.getForceAtlas2Worker();if(options=options||{},_root.URL=_root.URL||_root.webkitURL,this.sigInst=sigInst,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.config={},this.shouldUseWorker=options.worker===!1?!1:!0&&webWorkers,this.workerUrl=options.workerUrl,this.started=!1,this.running=!1,this.shouldUseWorker){if(this.workerUrl)this.worker=new Worker(this.workerUrl);else{var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob))}this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);this.msgName=this.worker?"message":"newCoords",this.listener=function(t){_this.nodesByteArray=new Float32Array(t.data.nodes),_this.running&&(_this.applyLayoutChanges(),_this.sendByteArrayToWorker(),_this.sigInst.refresh())},(this.worker||document).addEventListener(this.msgName,this.listener),this.graphToByteArrays(),sigInst.bind("kill",function(){sigInst.killForceAtlas2()})}if("undefined"==typeof sigma)throw"sigma is not declared";var _root=this,webWorkers="Worker"in _root;Supervisor.prototype.makeBlob=function(t){var e;try{e=new Blob([t],{type:"application/javascript"})}catch(r){_root.BlobBuilder=_root.BlobBuilder||_root.WebKitBlobBuilder||_root.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e},Supervisor.prototype.graphToByteArrays=function(){var t,e,r,i=this.graph.nodes(),o=this.graph.edges(),n=i.length*this.ppn,s=o.length*this.ppe,a={};for(this.nodesByteArray=new Float32Array(n),this.edgesByteArray=new Float32Array(s),t=e=0,r=i.length;r>t;t++)a[i[t].id]=e,this.nodesByteArray[e]=i[t].x,this.nodesByteArray[e+1]=i[t].y,this.nodesByteArray[e+2]=0,this.nodesByteArray[e+3]=0,this.nodesByteArray[e+4]=0,this.nodesByteArray[e+5]=0,this.nodesByteArray[e+6]=1+this.graph.degree(i[t].id),this.nodesByteArray[e+7]=1,this.nodesByteArray[e+8]=i[t].size,this.nodesByteArray[e+9]=0,e+=this.ppn;for(t=e=0,r=o.length;r>t;t++)this.edgesByteArray[e]=a[o[t].source],this.edgesByteArray[e+1]=a[o[t].target],this.edgesByteArray[e+2]=o[t].weight||0,e+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(){for(var t=this.graph.nodes(),e=0,r=0,i=this.nodesByteArray.length;i>r;r+=this.ppn)t[e].x=this.nodesByteArray[r],t[e].y=this.nodesByteArray[r+1],e++},Supervisor.prototype.sendByteArrayToWorker=function(t){var e={action:t||"loop",nodes:this.nodesByteArray.buffer},r=[this.nodesByteArray.buffer];"start"===t&&(e.config=this.config||{},e.edges=this.edgesByteArray.buffer,r.push(this.edgesByteArray.buffer)),this.shouldUseWorker?this.worker.postMessage(e,r):_root.postMessage(e,"*")},Supervisor.prototype.start=function(){if(!this.running){this.running=!0;var t,e;for(t in this.sigInst.cameras)e=this.sigInst.cameras[t],e.edgequadtree._enabled=!1;this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0)}},Supervisor.prototype.stop=function(){if(this.running){var t,e,r;for(t in this.sigInst.cameras)e=this.sigInst.cameras[t],e.edgequadtree._enabled=!0,r=sigma.utils.getBoundaries(this.graph,e.readPrefix),e.settings("drawEdges")&&e.settings("enableEdgeHovering")&&e.edgequadtree.index(this.sigInst.graph,{prefix:e.readPrefix,bounds:{x:r.minX,y:r.minY,width:r.maxX-r.minX,height:r.maxY-r.minY}});this.running=!1}},Supervisor.prototype.killWorker=function(){this.worker?this.worker.terminate():(_root.postMessage({action:"kill"},"*"),document.removeEventListener(this.msgName,this.listener))},Supervisor.prototype.configure=function(t){if(this.config=t,this.started){var e={action:"config",config:this.config};this.shouldUseWorker?this.worker.postMessage(e):_root.postMessage(e,"*")}},sigma.prototype.startForceAtlas2=function(t){return this.supervisor||(this.supervisor=new Supervisor(this,t)),t&&this.supervisor.configure(t),this.supervisor.start(),this},sigma.prototype.stopForceAtlas2=function(){return this.supervisor?(this.supervisor.stop(),this):this},sigma.prototype.killForceAtlas2=function(){return this.supervisor?(this.supervisor.stop(),this.supervisor.killWorker(),this.supervisor=null,this):this},sigma.prototype.configForceAtlas2=function(t){return this.supervisor||(this.supervisor=new Supervisor(this,t)),this.supervisor.configure(t),this},sigma.prototype.isForceAtlas2Running=function(){return this.supervisor&&this.supervisor.running}}).call(this),function(undefined){"use strict";function no_crush(t){var e,r,i,o=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],n=["source","target","weight"];for(r=0,i=o.length;i>r;r++)e=new RegExp("np\\(([^,]*), '"+o[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);for(r=0,i=n.length;i>r;r++)e=new RegExp("ep\\(([^,]*), '"+n[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);return t}function getWorkerFn(){var t=crush?crush(Worker.toString()):Worker.toString();return";("+t+").call(this);"}var _root=this,inWebWorker=!("document"in _root),Worker=function(){function t(){var t,e,r={},i=arguments.length;for(t=i-1;t>=0;t--)for(e in arguments[t])r[e]=arguments[t][e];return r}function e(t){var e;for(e in t)"hasOwnProperty"in t&&!t.hasOwnProperty(e)||delete t[e];return t}function r(t,e,r){r=r||{};a.nodeMatrix=t,a.edgeMatrix=e,a.nodesLength=a.nodeMatrix.length,a.edgesLength=a.edgeMatrix.length,i(r)}function i(e){e.barnesHutOptimize=!1,a.settings=t(e,a.settings)}function o(){var t,e,r,i,o,n,s,d,h,g,M,p,u,x,l;for(r=0;r<a.nodesLength;r+=a.ppn)a.nodeMatrix[r+4]=a.nodeMatrix[r+2],a.nodeMatrix[r+5]=a.nodeMatrix[r+3],a.nodeMatrix[r+2]=0,a.nodeMatrix[r+3]=0;if(a.settings.outboundAttractionDistribution){for(h=0,r=0;r<a.nodesLength;r+=a.ppn)h+=a.nodeMatrix[r+6];h/=a.nodesLength}if(a.settings.barnesHutOptimize){var c,f,y=Math.pow(2,2*a.settings.barnesHutDepthLimit),w=Math.pow(2,a.settings.barnesHutDepthLimit),v=new UInt16Array(y),m=(new Float32Array(y*a.ppq),new UInt16Array(y)),b=(new UInt16Array(y),new UInt16Array(a.nodesLength)),k=(new UInt16Array(a.nodesLength),0),A=0,B=0,L=0;for(r=0;r<a.nodesLength;r+=a.ppn)k=Math.max(k,a.nodeMatrix[r]),B=Math.min(B,a.nodeMatrix[r]),A=Math.max(A,a.nodeMatrix[r+1]),L=Math.min(L,a.nodeMatrix[r+1]);for(k+=1e-4*(k-B),A+=1e-4*(A-L),r=0,e=0;r<a.nodesLength;r+=a.ppn,e++)c=(a.nodeMatrix[r]-B)/(k-B)*Math.pow(2,a.settings.barnesHutDepthLimit)|0,f=(a.nodeMatrix[r+1]-L)/(A-L)*Math.pow(2,a.settings.barnesHutDepthLimit)|0,v[c*w+f]+=1,b[e]=c*w+f;for(t=0,e=0;y>e;e++)t+=v[e],m[e]=t}if(a.settings.barnesHutOptimize);else for(i=0;i<a.nodesLength;i+=a.ppn)for(o=0;o<a.nodesLength;o+=a.ppn)M=a.nodeMatrix[i]-a.nodeMatrix[o],p=a.nodeMatrix[i+1]-a.nodeMatrix[o+1],a.settings.adjustSize?(x=Math.sqrt(M*M+p*p)-a.nodeMatrix[i+8]-a.nodeMatrix[o+8],x>0?(l=a.settings.scalingRatio*a.nodeMatrix[i+6]*a.nodeMatrix[o+6]/x/x,a.nodeMatrix[i+2]+=M*l,a.nodeMatrix[i+3]+=p*l,a.nodeMatrix[o+2]+=M*l,a.nodeMatrix[o+3]+=p*l):0>x&&(l=100*a.settings.scalingRatio*a.nodeMatrix[i+6]*a.nodeMatrix[o+6],a.nodeMatrix[i+2]+=M*l,a.nodeMatrix[i+3]+=p*l,a.nodeMatrix[o+2]-=M*l,a.nodeMatrix[o+3]-=p*l)):(x=Math.sqrt(M*M+p*p),x>0&&(l=a.settings.scalingRatio*a.nodeMatrix[i+6]*a.nodeMatrix[o+6]/x/x,a.nodeMatrix[i+2]+=M*l,a.nodeMatrix[i+3]+=p*l,a.nodeMatrix[o+2]-=M*l,a.nodeMatrix[o+3]-=p*l));for(d=a.settings.gravity/a.settings.scalingRatio,g=a.settings.scalingRatio,r=0;r<a.nodesLength;r+=a.ppn)l=0,M=a.nodeMatrix[r],p=a.nodeMatrix[r+1],x=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)),a.settings.strongGravityMode?x>0&&(l=g*a.nodeMatrix[r+6]*d):x>0&&(l=g*a.nodeMatrix[r+6]*d/x),a.nodeMatrix[r+2]-=M*l,a.nodeMatrix[r+3]-=p*l;for(g=1*(a.settings.outboundAttractionDistribution?h:1),n=0;n<a.edgesLength;n+=a.ppe)i=a.edgeMatrix[n],o=a.edgeMatrix[n+1],s=a.edgeMatrix[n+2],u=0===a.settings.edgeWeightInfluence?1:1===a.settings.edgeWeightInfluence?s:Math.pow(s,a.settings.edgeWeightInfluence),M=a.nodeMatrix[i]-a.nodeMatrix[o],p=a.nodeMatrix[i+1]-a.nodeMatrix[o+1],a.settings.adjustSizes?(x=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)-a.nodeMatrix[i+8]-a.nodeMatrix[o+8]),a.settings.linLogMode?a.settings.outboundAttractionDistribution?x>0&&(l=-g*u*Math.log(1+x)/x/a.nodeMatrix[i+6]):x>0&&(l=-g*u*Math.log(1+x)/x):a.settings.outboundAttractionDistribution?x>0&&(l=-g*u/a.nodeMatrix[i+6]):x>0&&(l=-g*u)):(x=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)),a.settings.linLogMode?a.settings.outboundAttractionDistribution?x>0&&(l=-g*u*Math.log(1+x)/x/a.nodeMatrix[i+6]):x>0&&(l=-g*u*Math.log(1+x)/x):a.settings.outboundAttractionDistribution?(x=1,l=-g*u/a.nodeMatrix[i+6]):(x=1,l=-g*u)),x>0&&(a.nodeMatrix[i+2]+=M*l,a.nodeMatrix[i+3]+=p*l,a.nodeMatrix[o+2]-=M*l,a.nodeMatrix[o+3]-=p*l);var W,F,_,I;if(a.settings.adjustSizes)for(r=0;r<a.nodesLength;r+=a.ppn)a.nodeMatrix[r+9]||(W=Math.sqrt(Math.pow(a.nodeMatrix[r+2],2)+Math.pow(a.nodeMatrix[r+3],2)),W>a.maxForce&&(a.nodeMatrix[r+2]=a.nodeMatrix[r+2]*a.maxForce/W,a.nodeMatrix[r+3]=a.nodeMatrix[r+3]*a.maxForce/W),F=a.nodeMatrix[r+6]*Math.sqrt((a.nodeMatrix[r+4]-a.nodeMatrix[r+2])*(a.nodeMatrix[r+4]-a.nodeMatrix[r+2])+(a.nodeMatrix[r+5]-a.nodeMatrix[r+3])*(a.nodeMatrix[r+5]-a.nodeMatrix[r+3])),_=Math.sqrt((a.nodeMatrix[r+4]+a.nodeMatrix[r+2])*(a.nodeMatrix[r+4]+a.nodeMatrix[r+2])+(a.nodeMatrix[r+5]+a.nodeMatrix[r+3])*(a.nodeMatrix[r+5]+a.nodeMatrix[r+3]))/2,I=.1*Math.log(1+_)/(1+Math.sqrt(F)),a.nodeMatrix[r]=a.nodeMatrix[r]+a.nodeMatrix[r+2]*(I/a.settings.slowDown),a.nodeMatrix[r+1]=a.nodeMatrix[r+1]+a.nodeMatrix[r+3]*(I/a.settings.slowDown));else for(r=0;r<a.nodesLength;r+=a.ppn)a.nodeMatrix[r+9]||(F=a.nodeMatrix[r+6]*Math.sqrt((a.nodeMatrix[r+4]-a.nodeMatrix[r+2])*(a.nodeMatrix[r+4]-a.nodeMatrix[r+2])+(a.nodeMatrix[r+5]-a.nodeMatrix[r+3])*(a.nodeMatrix[r+5]-a.nodeMatrix[r+3])),_=Math.sqrt((a.nodeMatrix[r+4]+a.nodeMatrix[r+2])*(a.nodeMatrix[r+4]+a.nodeMatrix[r+2])+(a.nodeMatrix[r+5]+a.nodeMatrix[r+3])*(a.nodeMatrix[r+5]+a.nodeMatrix[r+3]))/2,I=a.nodeMatrix[r+7]*Math.log(1+_)/(1+Math.sqrt(F)),a.nodeMatrix[r+7]=Math.min(1,Math.sqrt(I*(Math.pow(a.nodeMatrix[r+2],2)+Math.pow(a.nodeMatrix[r+3],2))/(1+Math.sqrt(F)))),a.nodeMatrix[r]=a.nodeMatrix[r]+a.nodeMatrix[r+2]*(I/a.settings.slowDown),a.nodeMatrix[r+1]=a.nodeMatrix[r+1]+a.nodeMatrix[r+3]*(I/a.settings.slowDown));a.iterations++}function n(){o(),s()}var s,a={ppn:10,ppe:3,ppq:2,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:1.2,barnesHutDepthLimit:4}};s="undefined"!=typeof window&&window.document?function(){var t=new Event("newCoords");t.data={nodes:a.nodeMatrix.buffer},requestAnimationFrame(function(){document.dispatchEvent(t)})}:function(){self.postMessage({nodes:a.nodeMatrix.buffer},[a.nodeMatrix.buffer])};var d=function(t){switch(t.data.action){case"start":r(new Float32Array(t.data.nodes),new Float32Array(t.data.edges),t.data.config),n();break;case"loop":a.nodeMatrix=new Float32Array(t.data.nodes),n();break;case"config":i(t.data.config);break;case"kill":e(a),self.removeEventListener("message",d)}};self.addEventListener("message",d)},crush=null;if(inWebWorker)eval(getWorkerFn());else{if("undefined"==typeof sigma)throw"sigma is not declared";sigma.prototype.getForceAtlas2Worker=getWorkerFn}}.call(this);